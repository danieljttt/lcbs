<!DOCTYPE html>
<html lang="lv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fantasy Likmes â€“ Supabase Edition</title>
<style>
body {font-family: Arial, sans-serif; background:#0e0e0e; color:#fff; margin:0; padding:0;}
.bet-card {background:#1a1a1a; border-radius:12px; padding:10px; margin:10px; box-shadow:0 0 10px rgba(0,0,0,0.5);}
.bet-grid {display:grid; grid-template-columns:1fr auto 1fr; align-items:center; text-align:center; gap:10px;}
.bet-team {border:2px solid #333; border-radius:10px; padding:6px; position:relative;}
.bet-vs {font-weight:bold;}
.win-glow {border:2px solid #00ff88 !important; box-shadow:0 0 15px #00ff88; animation:rainbowGlow 3s infinite linear;}
@keyframes rainbowGlow {
  0% {box-shadow:0 0 15px #00ff88;border-color:#00ff88;}
  33% {box-shadow:0 0 15px #ffaa00;border-color:#ffaa00;}
  66% {box-shadow:0 0 15px #0099ff;border-color:#0099ff;}
  100% {box-shadow:0 0 15px #00ff88;border-color:#00ff88;}
}
.pikachu-flag {position:absolute;top:-35px;right:-10px;width:40px;height:40px;animation:bouncePika 1.2s infinite ease-in-out;}
@keyframes bouncePika {0%,100%{transform:translateY(0);}50%{transform:translateY(-5px);}}
.win-label {color:#fff;font-weight:bold;margin-top:5px;}
</style>
</head>
<body>
<h2 style="text-align:center;margin-top:10px;">ğŸ’° Likmes</h2>
<div id="betCards"></div>

<script type="module">
import { supabase, loadMatches, setWinner, placeBet, login, register } from './supabase.js';

window.loadMatches = loadMatches;
window.setWinner = setWinner;

window.placeBet = async function(matchId, side) {
  const user = JSON.parse(localStorage.getItem("user"));
  if (!user) return alert("Ieiet kontÄ, lai liktu likmes!");
  await placeBet(user.id, matchId, side, 10);
  alert("Likme pieÅ†emta!");
};

window.login = async function() {
  const user = await login(prompt("LietotÄjvÄrds:"), prompt("Parole:"));
  if (user) alert("Sveiks, " + user.username + "!");
};

window.register = async function() {
  const user = await register(prompt("Jauns lietotÄjvÄrds:"), prompt("Parole:"));
  if (user) alert("ReÄ£istrÄcija veiksmÄ«ga!");
};

window.settleMatch = async function(id, side) {
  await setWinner(id, side);
  renderBets();
};

window.renderBets = async function() {
  const matches = await loadMatches();
  document.getElementById("betCards").innerHTML = matches.map(m => {
    const winA = m.winner === 'A';
    const winB = m.winner === 'B';
    const hasWinner = winA || winB;
    const pikachu = hasWinner ? `<img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/25.png" class="pikachu-flag">` : '';
    return `
      <div class="bet-card">
        <div class="bet-grid">
          <div class="bet-team ${winA ? 'win-glow' : ''}">
            ${winA ? pikachu : ''}
            <b>${m.team_a}</b>
            ${winA ? '<div class="win-label">ğŸ† UzvarÄ“tÄjs!</div>' : ''}
          </div>
          <div class="bet-vs">vs</div>
          <div class="bet-team ${winB ? 'win-glow' : ''}">
            ${winB ? pikachu : ''}
            <b>${m.team_b}</b>
            ${winB ? '<div class="win-label">ğŸ† UzvarÄ“tÄjs!</div>' : ''}
          </div>
        </div>
        ${m.open
          ? `<button onclick="placeBet(${m.id},'A')">Likts uz ${m.team_a}</button>
             <button onclick="placeBet(${m.id},'B')">Likts uz ${m.team_b}</button>`
          : '<span class="win-label">MaÄs noslÄ“gts</span>'}
        <div style="margin-top:4px;">
          <button onclick="settleMatch(${m.id},'A')">Uzvara ${m.team_a}</button>
          <button onclick="settleMatch(${m.id},'B')">Uzvara ${m.team_b}</button>
        </div>
      </div>`;
  }).join('');
};

renderBets();
</script>
</body>
</html>
