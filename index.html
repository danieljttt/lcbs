<!doctype html>
<html lang="lv">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>LCBS Fantasy</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<main id="content">
  <section id="tab-home" class="tab active">
    <h2>Sākums</h2>
    <p class="note">Laipni lūdzam LCBS Fantasy!</p>
    <div class="auth-box">
      <input id="uName" placeholder="lietotājvārds">
      <input id="uPass" placeholder="parole" type="password">
      <button id="btnReg">Reģistrēties</button>
      <button id="btnLogin">Pieteikties</button>
      <button id="btnLogout" class="hide">Izrakstīties</button>
    </div>
    <p>Likmju bilance: <b id="userBalanceBets">0</b> | Fantasy kredīti: <b id="userBalanceFantasy">0</b></p>
  </section>

  <section id="tab-fantasy" class="tab">
    <h2>Mana Fantasy komanda</h2>
    <div id="myTeamBox"></div>
    <h2>Pieejamie spēlētāji</h2>
    <div id="allPlayersBox"></div>
  </section>

  <section id="tab-bets" class="tab">
    <h2>Likmes</h2>
    <div id="matchList" class="match-list"></div>
    <h2>Rezultāti</h2>
    <div id="resultList" class="match-list"></div>
  </section>

  <section id="tab-profile" class="tab">
    <h2>Profils</h2>
    <div class="usercard">
      <div>ID: <span id="meId">—</span></div>
    </div>
  </section>
</main>

<!-- Telegram-style bottom navigation -->
<nav class="bottom-nav">
  <button data-tab="home" class="active">
    <svg viewBox="0 0 24 24"><path d="M3 9.5L12 3l9 6.5V21H3V9.5z"/></svg>
    <span>Sākums</span>
  </button>
  <button data-tab="fantasy">
    <svg viewBox="0 0 24 24"><path d="M12 2l9 4v6c0 5-4 9-9 9s-9-4-9-9V6l9-4z"/></svg>
    <span>Fantasy</span>
  </button>
  <button data-tab="bets">
    <svg viewBox="0 0 24 24"><path d="M4 4h16v16H4z"/></svg>
    <span>Likmes</span>
  </button>
  <button data-tab="profile">
    <svg viewBox="0 0 24 24"><path d="M12 12a5 5 0 1 0 0-10 5 5 0 0 0 0 10zm-9 9c0-4 4-7 9-7s9 3 9 7"/></svg>
    <span>Profils</span>
  </button>
</nav>

<script type="module" src="firebase.js"></script>
<script type="module">
const $ = s=>document.querySelector(s);
const $$ = s=>document.querySelectorAll(s);

function showTab(name){
  $$('.tab').forEach(t=>t.classList.toggle('active',t.id==='tab-'+name));
  $$('.bottom-nav button').forEach(b=>b.classList.toggle('active',b.dataset.tab===name));
  localStorage.setItem('lcbs_tab',name);
}
$$('.bottom-nav button').forEach(b=>b.onclick=()=>showTab(b.dataset.tab));
showTab(localStorage.getItem('lcbs_tab')||'home');

// Fantasy kredītu atgriešana
import { database, get, ref, update } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";
import { getCurrentUser, getFantasyPlayers } from './firebase.js';

window.refundFantasy = async function(playerId){
  const user = getCurrentUser();
  if(!user) return;
  const all = await getFantasyPlayers();
  const p = all.find(x=>x.id===playerId);
  if(!p) return;
  const cost = p.price || (p.tier===1?6:p.tier===2?4:2);
  const snap = await get(ref(database,`users/${user.id}/balances/balanceFantasy`));
  const cur = snap.exists()?snap.val():0;
  await update(ref(database,`users/${user.id}/balances`),{balanceFantasy:cur+cost});
  alert(`Atgriezti ${cost} kredīti`);
}
</script>
</body>
</html>
