<!DOCTYPE html>
<html lang="lv">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>LCBS Fantasy</title>
<link rel="stylesheet" href="style.css">
<script type="module" src="firebase.js"></script>
</head>
<body>

<header id="header">
  <h1>LCBS Fantasy</h1>
</header>

<main id="content">
  <section id="tab-home" class="tab">
    <div id="authBox">
      <input id="uName" placeholder="lietotājvārds">
      <input id="uPass" type="password" placeholder="parole">
      <button id="btnReg">Reģistrēties</button>
      <button id="btnLogin">Pieteikties</button>
    </div>
    <div id="userBox" class="hide">
      <span id="userLabel"></span>
      <button id="btnLogout">Izrakstīties</button>
    </div>
    <div id="balancesBox">
      <p>Likmju bilance: <b id="userBalanceBets">0</b></p>
      <p>Fantasy kredīti: <b id="userBalanceFantasy">0</b></p>
    </div>
  </section>

  <section id="tab-fantasy" class="tab hide">
    <h2>Mana Fantasy komanda</h2>
    <div id="fantasyTeam"></div>
    <h3>Pieejamie spēlētāji</h3>
    <div id="fantasyPlayers"></div>
  </section>

  <section id="tab-bets" class="tab hide">
    <h2>Likmes</h2>
    <div id="matchesList"></div>
    <h3>Rezultāti</h3>
    <div id="resultsList"></div>
  </section>

  <section id="tab-profile" class="tab hide">
    <h2>Profils</h2>
    <div id="adminPanel" class="hide"></div>
  </section>
</main>

<!-- Telegram style bottom navigation -->
<nav class="bottom-nav">
  <button data-tab="home" class="active">
    <svg viewBox="0 0 24 24"><path d="M3 9.5L12 3l9 6.5V21H3V9.5z"/></svg>
    <span>Sākums</span>
  </button>
  <button data-tab="fantasy">
    <svg viewBox="0 0 24 24"><path d="M12 2l9 4v6c0 5-4 9-9 9s-9-4-9-9V6l9-4z"/></svg>
    <span>Fantasy</span>
  </button>
  <button data-tab="bets">
    <svg viewBox="0 0 24 24"><path d="M4 4h16v16H4z"/></svg>
    <span>Likmes</span>
  </button>
  <button data-tab="profile">
    <svg viewBox="0 0 24 24"><path d="M12 12a5 5 0 1 0 0-10 5 5 0 0 0 0 10zm-9 9c0-4 4-7 9-7s9 3 9 7"/></svg>
    <span>Profils</span>
  </button>
</nav>

<script type="module">
import { getCurrentUser, registerUser, loginUser, logoutUser, getUserBalances, refreshFantasy, renderAll, setInitialFantasyIfNeeded } from './firebase.js';

const $ = s => document.querySelector(s);
const $$ = s => document.querySelectorAll(s);

function showTab(name){
  $$('.tab').forEach(t=>t.classList.toggle('hide',t.id!=='tab-'+name));
  $$('.bottom-nav button').forEach(b=>b.classList.toggle('active',b.dataset.tab===name));
  localStorage.setItem('lcbs_tab',name);
}
$$('.bottom-nav button').forEach(b=>b.onclick=()=>showTab(b.dataset.tab));
showTab(localStorage.getItem('lcbs_tab')||'home');

async function refreshAuthUI(){
  const u=getCurrentUser();
  $('#authBox').classList.toggle('hide',!!u);
  $('#userBox').classList.toggle('hide',!u);
  if(u){ $('#userLabel').textContent=u.username; }
}
async function refreshBalances(){
  const u=getCurrentUser();
  if(!u) return;
  const b=await getUserBalances(u.id);
  $('#userBalanceBets').textContent=b.balanceBets||0;
  $('#userBalanceFantasy').textContent=b.balanceFantasy||0;
}

$('#btnReg').onclick = async ()=>{
  const u=$('#uName').value.trim(), p=$('#uPass').value.trim();
  if(!u||!p) return alert('Ievadi lietotājvārdu un paroli');
  const ok=await registerUser(u,p);
  if(ok){ refreshAuthUI(); await setInitialFantasyIfNeeded(); await refreshBalances(); renderAll(); }
};
$('#btnLogin').onclick = async ()=>{
  const u=$('#uName').value.trim(), p=$('#uPass').value.trim();
  const me=await loginUser(u,p);
  if(me){ refreshAuthUI(); await setInitialFantasyIfNeeded(); await refreshBalances(); renderAll(); }
};
$('#btnLogout').onclick = async ()=>{
  await logoutUser();
  refreshAuthUI();
  showTab('home');
};

refreshAuthUI();
refreshBalances();
</script>
</body>
</html>
